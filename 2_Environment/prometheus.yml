# Prometheus Configuration for DaVinci Resolve Monitoring
# This configuration sets up scraping for Windows system metrics and DaVinci Resolve metrics

global:
  scrape_interval: 15s # Scrape targets every 15 seconds
  evaluation_interval: 15s # Evaluate rules every 15 seconds
  external_labels:
    cluster: 'davinci-resolve-workstation'
    environment: 'local'

# Alertmanager configuration (optional)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets:
#           - localhost:9093

# Load rules once and periodically evaluate them
# rule_files:
#   - "rules/*.yml"

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
        labels:
          component: 'prometheus'

  # Windows system metrics (CPU, Memory, Disk, Network, GPU)
  - job_name: 'windows_exporter'
    scrape_interval: 10s
    static_configs:
      - targets: ['localhost:9182']
        labels:
          component: 'windows_exporter'
          hostname: 'davinci-workstation'
    # Relabel to get meaningful metric names
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'windows_.*'
        action: keep

  # DaVinci Resolve custom metrics
  - job_name: 'davinci_resolve_exporter'
    scrape_interval: 30s
    static_configs:
      - targets: ['localhost:9183']
        labels:
          component: 'davinci_resolve'
          application: 'davinci-resolve'
    # Keep only DaVinci Resolve metrics
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'davinci_.*'
        action: keep

  # Node exporter (if running on Linux subsystem)
  # - job_name: 'node_exporter'
  #   static_configs:
  #     - targets: ['localhost:9100']

# Storage configuration
storage:
  tsdb:
    path: data/
    retention:
      time: 30d # Keep metrics for 30 days
      size: 10GB # Maximum storage size
